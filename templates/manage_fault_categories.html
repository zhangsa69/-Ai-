<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>ç®¡ç†æ•…éšœç±»åˆ«</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/admin-styles.css') }}">
    <!--[if IE]>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/admin-styles.css') }}">
    <![endif]-->
</head>
<body>
    <canvas id="canvas"></canvas>

    <!-- é¡µé¢æ ‡é¢˜ -->
    <div class="page-header">
        <h1>æ²³åŒ—äº¬è½¦è¿ç»´ç®¡ç†ç³»ç»Ÿ</h1>
        <!-- æ˜¾ç¤ºæç¤ºä¿¡æ¯ -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="flash-message {{ category }}">{{ message }}</div>
                {% endfor %}
            {% endif %}
        {% endwith %}
    </div>

    <!-- ä¸‰å®¹å™¨å¹¶åˆ—å¸ƒå±€ -->
    <div class="triple-container-layout">
        <!-- å·¦ä¾§å®¹å™¨ï¼šæœ€è¿‘å·¥å• -->
        <div class="container-left">
            <div class="section-header">
                <h2>æœ€è¿‘å·¥å•</h2>
                <a href="{{ url_for('export_excel') }}" class="export-btn">
                    <span class="icon">ğŸ“¥</span> å¯¼å‡ºExcel
                </a>
            </div>
            <div class="events-list">
                {% if recent_events and recent_events|length > 0 %}
                    {% for ev in recent_events %}
                    <div class="event-card">
                        <div class="event-main">
                            <div class="event-line"><span class="label">æè¿°</span><span class="value">{{ ev.description }}</span></div>
                            <div class="event-line"><span class="label">å§“å</span><span class="value">{{ ev.name }}</span></div>
                            <div class="event-line"><span class="label">éƒ¨é—¨</span><span class="value">{{ ev.department }}</span></div>
                            <div class="event-line"><span class="label">ç±»åˆ«</span><span class="value">{{ ev.category }}</span></div>
                            <div class="event-status {{ 'resolved' if ev.status == 'å·²è§£å†³' else 'pending' }}">{{ ev.status or 'å¾…è§£å†³' }}</div>
                        </div>
                        <div class="event-actions">
                            {% if ev.status != 'å·²è§£å†³' %}
                            <form action="{{ url_for('resolve_ticket') }}" method="post" class="resolve-form">
                                <input type="hidden" name="timestamp" value="{{ ev.timestamp_raw or ev.timestamp }}">
                                <input type="hidden" name="name" value="{{ ev.name }}">
                                <input type="hidden" name="description" value="{{ ev.description }}">

                                <textarea name="remarks" class="remarks-input" placeholder="åœ¨æ­¤è®°å½•ç»´ä¿®è¿‡ç¨‹..."></textarea>

                                <button type="submit" class="resolve-btn">æäº¤è§£å†³</button>
                            </form>
                            {% else %}
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                {% else %}
                    <div class="loading-message">æš‚æ— å·¥å•æ•°æ®</div>
                {% endif %}
            </div>
        </div>

        <!-- ä¸­é—´å®¹å™¨ï¼šæ•…éšœç±»åˆ«ç®¡ç† -->
        <div class="container-middle">
            <h2>ç®¡ç†æ•…éšœç±»åˆ«</h2>
            
            <!-- æ·»åŠ æ–°æ•…éšœç±»åˆ« -->
            <form action="{{ url_for('manage_fault_categories') }}" method="post" class="add-form">
                <h3>æ·»åŠ æ–°æ•…éšœç±»åˆ«</h3>
                <div class="form-group full-width">
                    <label for="name" class="required">æ•…éšœç±»åˆ«åç§°ï¼š</label>
                    <input type="text" id="name" name="name" required>
                </div>
                <div class="form-group full-width">
                    <label for="contact_email" class="required">è”ç³»äººé‚®ç®±ï¼š</label>
                    <input type="text" id="contact_email" name="contact_email" required>
                </div>
                <button type="submit" name="action" value="add" class="submit-btn">æ·»åŠ </button>
            </form>

            <!-- æ•…éšœç±»åˆ«åˆ—è¡¨ -->
            <h3>ç°æœ‰æ•…éšœç±»åˆ«</h3>
            <table class="fault-table">
                <thead>
                    <tr>
                        <th>æ•…éšœç±»åˆ«</th>
                        <th>è”ç³»äººé‚®ç®±</th>
                        <th>æ“ä½œ</th>
                    </tr>
                </thead>
                <tbody>
                    {% for category in categories %}
                        <tr>
                            <td>{{ category.name }}</td>
                            <td>{{ category.contact_email }}</td>
                            <td>
                                <!-- ä¿®æ”¹è¡¨å• -->
                                <form action="{{ url_for('manage_fault_categories') }}" method="post" class="inline-form">
                                    <input type="hidden" name="category_id" value="{{ category.id }}">
                                    <button type="submit" name="action" value="edit" class="edit-btn">ä¿®æ”¹</button>
                                </form>
                                <!-- åˆ é™¤è¡¨å• -->
                                <form action="{{ url_for('manage_fault_categories') }}" method="post" class="inline-form" onsubmit="return confirm('ç¡®å®šè¦åˆ é™¤ {{ category.name }} å—ï¼Ÿ');">
                                    <input type="hidden" name="category_id" value="{{ category.id }}">
                                    <button type="submit" name="action" value="delete" class="delete-btn">åˆ é™¤</button>
                                </form>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>

        </div>

        <!-- å³ä¾§å®¹å™¨ï¼šè¿ç»´å·¥å…· -->
        <div class="container-right">
            <h2>è¿ç»´å·¥å…·</h2>
            <div class="tools-grid">
                <a href="http://10.120.192.106:5000/" target="_blank" class="tool-item">
                    <div class="tool-icon">ğŸ”</div>
                    <div class="tool-name">è®¾å¤‡å¿«æŸ¥</div>
                </a>
                <a href="http://10.120.192.24" target="_blank" class="tool-item">
                    <div class="tool-icon">â˜ï¸</div>
                    <div class="tool-name">ä¼ä¸šäº‘ç›˜</div>
                </a>
                <a href="https://10.120.192.105:28443/" target="_blank" class="tool-item">
                    <div class="tool-icon">ğŸ”’</div>
                    <div class="tool-name">å®‰å…¨ç³»ç»Ÿ</div>
                </a>
                <a href="http://10.120.65.148/datasets" target="_blank" class="tool-item">
                    <div class="tool-icon">ğŸ“š</div>
                    <div class="tool-name">çŸ¥è¯†åº“ç®¡ç†</div>
                </a>
                <a href="https://10.120.196.200:8443/OPMUI/jsp/secospace/login.jsp#/" target="_blank" class="tool-item">
                    <div class="tool-icon">ğŸŒ</div>
                    <div class="tool-name">ä¸Šç½‘è¡Œä¸ºç®¡ç†</div>
                </a>
                <a href="https://mail.rtte.cn:8089/webadmin/" target="_blank" class="tool-item">
                    <div class="tool-icon">ğŸ“§</div>
                    <div class="tool-name">é‚®ç®±ç®¡ç†</div>
                </a>
                <a href="https://10.120.252.10:8080/" target="_blank" class="tool-item">
                    <div class="tool-icon">ğŸ”</div>
                    <div class="tool-name">VPNç®¡ç†</div>
                </a>
                <a href="https://admin.microsoft.com/adminportal/home#/subscriptions/vlnew" target="_blank" class="tool-item">
                    <div class="tool-icon">ğŸ”‘</div>
                    <div class="tool-name">è½¯ä»¶æˆæƒç®¡ç†</div>
                </a>
                <a href="http://10.120.192.100:8080/zh-cn/" target="_blank" class="tool-item">
                    <div class="tool-icon">ğŸ–¨ï¸</div>
                    <div class="tool-name">æ‰“å°ç³»ç»Ÿç®¡ç†</div>
                </a>
                <a href="http://10.120.65.240/rms/u/login.shtml;JSESSIONID=2a8fad10-5618-4c55-b573-42d73940ed5a" target="_blank" class="tool-item">
                    <div class="tool-icon">ğŸ‘¥</div>
                    <div class="tool-name">è®¿å®¢ç®¡ç†</div>
                </a>
            </div>
        </div>
    </div>

    <script>
     window.difyChatbotConfig = {
      token: 'OCeSxdJSuLh6inAK',
      baseUrl: 'http://10.120.65.148',
      systemVariables: {
        // user_id: 'YOU CAN DEFINE USER ID HERE',
        // conversation_id: 'YOU CAN DEFINE CONVERSATION ID HERE, IT MUST BE A VALID UUID',
      },
     }
    </script>
    <script
     src="http://10.120.65.148/embed.min.js"
     id="OCeSxdJSuLh6inAK"
     defer>
    </script>
    <style>
      #dify-chatbot-bubble-button {
        background-color: #1C64F2 !important;
        position: fixed !important;
        z-index: 9999 !important;
      }
      #dify-chatbot-bubble-window {
        width: 24rem !important;
        height: 40rem !important;
        position: fixed !important;
        z-index: 9998 !important;
        bottom: 100px !important;
        right: 20px !important;
      }
      /* ç¡®ä¿å¯¹è¯çª—å£è·ŸéšæŒ‰é’®ä½ç½® */
      .dify-chatbot-window {
        position: fixed !important;
        z-index: 9998 !important;
      }
      /* è°ƒæ•´å¯¹è¯çª—å£çš„å®šä½ï¼Œä½¿å…¶å§‹ç»ˆåœ¨æŒ‰é’®ä¸Šæ–¹ */
      [data-dify-window] {
        position: fixed !important;
        bottom: 100px !important;
        right: 20px !important;
        z-index: 9998 !important;
      }
    </style>

    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
</body>
</html>